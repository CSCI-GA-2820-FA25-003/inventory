<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Inventory</title>
    <style>
      :root {
        color-scheme: light;
      }
      * {
        box-sizing: border-box;
      }
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        margin: 0;
        min-height: 100vh;
        background: radial-gradient(circle at top, #f2f7ff, #e8ecf3 45%, #dde3ee);
        color: #111;
      }
      .container {
        max-width: 960px;
        margin: 0 auto;
        padding: 2.5rem 1.5rem 3rem;
      }
      .hero {
        text-align: center;
        margin-bottom: 2rem;
      }
      .hero h1 {
        margin: 0;
        font-size: 2.4rem;
        letter-spacing: -0.5px;
      }
      .hero p {
        margin: 0.5rem auto 0;
        color: #4b5563;
        max-width: 520px;
        line-height: 1.5;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
      }
      .card {
        background: #fff;
        border-radius: 16px;
        padding: 1.75rem;
        box-shadow: 0 20px 45px rgba(15, 23, 42, 0.08);
        border: 1px solid rgba(226, 232, 240, 0.8);
      }
      .card h2 {
        margin: 0 0 1rem;
        font-size: 1.4rem;
      }
      .manage-card {
        grid-column: 1 / -1;
      }
      .form-grid {
        display: grid;
        gap: 0.9rem;
      }
      .form-grid .split {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 0.75rem;
      }
      form {
        display: grid;
        gap: 0.9rem;
      }
      label {
        display: flex;
        flex-direction: column;
        font-size: 0.9rem;
        font-weight: 600;
        color: #4b5563;
        gap: 0.35rem;
      }
      input[type="text"],
      input[type="number"] {
        width: 100%;
        padding: 0.65rem 0.75rem;
        border-radius: 10px;
        border: 1px solid #d7dce5;
        font-size: 1rem;
        transition: border-color 0.2s, box-shadow 0.2s;
      }
      input[type="text"]:focus,
      input[type="number"]:focus {
        outline: none;
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
      }
      .checkbox {
        flex-direction: row;
        align-items: center;
        gap: 0.5rem;
      }
      .actions {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
        margin-top: 0.25rem;
      }
      .manage-actions button {
        flex: 1 1 120px;
        min-width: 110px;
      }
      button {
        padding: 0.65rem 1.5rem;
        border: none;
        border-radius: 999px;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.15s, box-shadow 0.15s;
        background: #f1f5f9;
        color: #0f172a;
        box-shadow: 0 6px 16px rgba(15, 23, 42, 0.1);
      }
      button:active {
        transform: scale(0.97);
      }
      #submit {
        background: linear-gradient(135deg, #2563eb, #1d4ed8);
        color: #fff;
        box-shadow: 0 12px 24px rgba(37, 99, 235, 0.25);
      }
      #delete {
        background: linear-gradient(135deg, #f43f5e, #be123c);
        color: #fff;
        box-shadow: 0 12px 24px rgba(244, 63, 94, 0.25);
      }
      #search-btn,
      #list-btn,
      #query-btn {
        background: linear-gradient(135deg, #0ea5e9, #0284c7);
        color: #fff;
      }
      #retrieve-btn,
      #update-btn {
        background: linear-gradient(135deg, #6366f1, #4f46e5);
        color: #fff;
      }
      #delete-btn {
        background: linear-gradient(135deg, #fb7185, #e11d48);
        color: #fff;
      }
      #action-btn {
        background: linear-gradient(135deg, #34d399, #10b981);
        color: #0f172a;
      }
      #clear-btn {
        background: #f8fafc;
        color: #0f172a;
      }
      .result {
        background: #0f172a;
        color: #e2e8f0;
        padding: 1rem;
        border-radius: 12px;
        min-height: 3rem;
        white-space: pre-wrap;
        border: 1px solid rgba(226, 232, 240, 0.2);
        font-size: 0.9rem;
        overflow-x: auto;
      }
      .result + small {
        display: block;
        margin-top: 0.35rem;
        color: #94a3b8;
      }
      .flash {
        margin-top: 1rem;
        padding: 0.75rem 1rem;
        border-radius: 12px;
        background: #ecfdf5;
        border: 1px solid #bbf7d0;
        color: #166534;
        min-height: 2.5rem;
        display: flex;
        align-items: center;
        font-weight: 600;
      }
      .flash.error {
        background: #fef2f2;
        border-color: #fecaca;
        color: #991b1b;
      }
      @media (max-width: 600px) {
        .container {
          padding: 1.75rem 1rem 2rem;
        }
        .hero h1 {
          font-size: 2rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header class="hero">
        <h1>Inventory Console</h1>
        <p>Quickly create or delete inventory entries. Data is displayed in real-time in the response box below for easy API debugging.</p>
      </header>

      <div class="grid">
        <section class="card manage-card">
          <h2>Manage Inventory Items</h2>
          <form id="manage-form" class="form-grid" onsubmit="return false;">
            <div class="split">
              <label>Inventory ID
                <input id="inventory_id" name="inventory_id" type="number" min="1" placeholder="e.g. 5">
              </label>
              <label>Name
                <input id="inventory_name" name="inventory_name" type="text" placeholder="e.g. Coffee Beans">
              </label>
            </div>
            <div class="split">
              <label>SKU
                <input id="inventory_sku" name="inventory_sku" type="text" placeholder="DEMO-0001">
              </label>
              <label>Category
                <input id="inventory_category" name="inventory_category" type="text" placeholder="gadgets">
              </label>
            </div>
            <div class="split">
              <label>Quantity
                <input id="inventory_quantity" name="inventory_quantity" type="number" min="0" placeholder="0">
              </label>
              <label>Price
                <input id="inventory_price" name="inventory_price" type="number" step="0.01" min="0" placeholder="USD">
              </label>
            </div>
            <label>Description
              <input id="inventory_description" name="inventory_description" type="text" placeholder="Describe the item">
            </label>
            <label class="checkbox">
              <input id="inventory_available" name="inventory_available" type="checkbox" checked>
              Available
            </label>
          </form>
          <div class="actions manage-actions">
            <button id="search-btn" type="button">Search</button>
            <button id="list-btn" type="button">List</button>
            <button id="query-btn" type="button">Query</button>
            <button id="retrieve-btn" type="button">Retrieve</button>
            <button id="update-btn" type="button">Update</button>
            <button id="delete-btn" type="button">Delete</button>
            <button id="action-btn" type="button">Action</button>
            <button id="clear-btn" type="button">Clear</button>
          </div>
          <div id="flash_message" class="flash" aria-live="polite">Ready.</div>
          <h3>Results</h3>
          <pre id="search_results" class="result" aria-live="polite">No results yet.</pre>
        </section>

        <section class="card">
          <h2>Create Inventory</h2>
          <form id="inv-form">
            <label>Name
              <input id="name" name="name" type="text" placeholder="e.g. Coffee Beans" required>
            </label>
            <label>SKU
              <input id="sku" name="sku" type="text" placeholder="Unique SKU" required>
            </label>
            <label>Quantity
              <input id="quantity" name="quantity" type="number" min="0" value="0" required>
            </label>
            <label>Category
              <input id="category" name="category" type="text" placeholder="E.g. Computer, Phone">
            </label>
            <label>Description
              <input id="description" name="description" type="text" placeholder="Simply Describe the feature">
            </label>
            <label>Price
              <input id="price" name="price" type="number" step="0.01" min="0" placeholder="USD">
            </label>
            <label>Restock Level
              <input id="restock_level" name="restock_level" type="number" min="0" placeholder="e.g. 10">
            </label>
            <label class="checkbox">
              <input id="available" name="available" type="checkbox" checked>
              Available
            </label>
            <div class="actions">
              <button id="submit" type="button">Create</button>
            </div>
          </form>
          <h3>result</h3>
          <pre id="result" class="result" aria-live="polite"></pre>
          <small>The response will include the submitted payload to aid in troubleshooting.</small>
        </section>
        <section class="card">
          <h2>Check Restock Level</h2>
          <form id="status-form">
            <label>Inventory ID
              <input id="status-id" name="inventory_id" type="number" min="1" placeholder="Enter Inventory ID" required>
            </label>
            <div class="actions">
              <button id="status" type="button">Check Status</button>
            </div>
          </form>
          <h3>result</h3>
          <pre id="status-result" class="result" aria-live="polite"></pre>
          <small>The REST path for this operation is: GET /api/inventory/&lt;id&gt;/restock-status</small>
        </section>
        <section class="card">
          <h2>Read Inventory</h2>
          <form id="read-form">
            <label>Inventory ID
              <input id="read-id" name="inventory_id" type="number" min="1" placeholder="Enter Inventory ID" required>
            </label>
            <div class="actions">
              <button id="read" type="button">Read</button>
            </div>
          </form>
          <h3>result</h3>
          <pre id="read-result" class="result" aria-live="polite"></pre>
          <small>The REST path for this operation is: GET /api/inventory/&lt;id&gt;</small>
        </section>

        <section class="card">
          <h2>Delete Inventory</h2>
          <form id="delete-form">
            <label>Inventory ID
              <input id="delete-id" name="inventory_id" type="number" min="1" placeholder="Input ID Existed" required>
            </label>
            <div class="actions">
              <button id="delete" type="button">Delete</button>
            </div>
          </form>
          <h3>result</h3>
          <pre id="delete-result" class="result" aria-live="polite"></pre>
          <small>The REST path for the delete operation is: DELETE /api/inventory/&lt;id&gt;</small>
        </section>
      </div>
    </div>

    <script>
      // Safe getters by id
      function val(id) { const el = document.getElementById(id); return el ? el.value : ""; }
      function boolChecked(id) { const el = document.getElementById(id); return !!(el && el.checked); }

      const API_BASE = "/api";
      const INVENTORY_BASE = `${API_BASE}/inventory`;

      function setFlash(message, isError = false) {
        const flash = document.getElementById('flash_message');
        if (!flash) {
          return;
        }
        flash.textContent = message;
        flash.classList.toggle('error', !!isError);
      }

      function formatInventoryLine(inv) {
        if (!inv || typeof inv !== "object") {
          return String(inv === undefined || inv === null ? "" : inv);
        }
        const parts = [];
        if (Object.prototype.hasOwnProperty.call(inv, "id")) {
          parts.push(`Id: ${inv.id}`);
        }
        if (Object.prototype.hasOwnProperty.call(inv, "name")) {
          parts.push(`Name: ${inv.name}`);
        }
        if (Object.prototype.hasOwnProperty.call(inv, "category")) {
          const categoryValue = inv.category === undefined || inv.category === null ? "-" : inv.category;
          parts.push(`Category: ${categoryValue}`);
        }
        if (Object.prototype.hasOwnProperty.call(inv, "sku")) {
          const skuValue = inv.sku === undefined || inv.sku === null ? "-" : inv.sku;
          parts.push(`SKU: ${skuValue}`);
        }
        if (Object.prototype.hasOwnProperty.call(inv, "quantity")) {
          parts.push(`Qty: ${inv.quantity}`);
        }
        if (Object.prototype.hasOwnProperty.call(inv, "available")) {
          parts.push(`Available: ${inv.available ? "Yes" : "No"}`);
        }
        return parts.join(" | ");
      }

      function renderResults(payload) {
        const target = document.getElementById('search_results');
        if (!target) {
          return;
        }
        if (payload === undefined || payload === null) {
          target.textContent = "No results.";
          return;
        }
        if (Array.isArray(payload)) {
          if (payload.length === 0) {
            target.textContent = "No results.";
            return;
          }
          target.textContent = payload.map(formatInventoryLine).join("\n");
          return;
        }
        if (typeof payload === "object") {
          target.textContent = formatInventoryLine(payload);
          return;
        }
        if (typeof payload === "string") {
          target.textContent = payload;
          return;
        }
        try {
          target.textContent = JSON.stringify(payload, null, 2);
        } catch (err) {
          target.textContent = String(payload);
        }
      }

      function fillManageForm(data) {
        if (!data || typeof data !== "object") {
          return;
        }
        const mapping = {
          id: "inventory_id",
          name: "inventory_name",
          sku: "inventory_sku",
          category: "inventory_category",
          description: "inventory_description",
          quantity: "inventory_quantity",
          price: "inventory_price"
        };
        Object.entries(mapping).forEach(([key, fieldId]) => {
          const el = document.getElementById(fieldId);
          if (!el) {
            return;
          }
          const value = data[key];
          el.value = value === undefined || value === null ? "" : value;
        });
        const availableInput = document.getElementById('inventory_available');
        if (availableInput && Object.prototype.hasOwnProperty.call(data, 'available')) {
          availableInput.checked = !!data.available;
        }
      }

      function clearManageForm() {
        [
          'inventory_id',
          'inventory_name',
          'inventory_sku',
          'inventory_category',
          'inventory_description',
          'inventory_quantity',
          'inventory_price'
        ].forEach(id => {
          const el = document.getElementById(id);
          if (el) {
            el.value = "";
          }
        });
        const availableInput = document.getElementById('inventory_available');
        if (availableInput) {
          availableInput.checked = false;
        }
        renderResults("No results yet.");
        setFlash("Cleared");
      }

      function requireInventoryId() {
        const id = (val('inventory_id') || "").trim();
        if (!id) {
          setFlash("Please enter an Inventory ID first.", true);
          return null;
        }
        return id;
      }

      function buildUpdatePayload() {
        const name = (val('inventory_name') || "").trim();
        const sku = (val('inventory_sku') || "").trim();
        const category = (val('inventory_category') || "").trim();
        const description = (val('inventory_description') || "").trim();
        const quantityRaw = (val('inventory_quantity') || "").trim();
        const priceRaw = (val('inventory_price') || "").trim();

        if (!name || !sku) {
          throw new Error("Name and SKU are required.");
        }
        if (!quantityRaw) {
          throw new Error("Quantity is required.");
        }
        if (!priceRaw) {
          throw new Error("Price is required.");
        }
        const quantity = Number(quantityRaw);
        const price = Number(priceRaw);
        if (!Number.isFinite(quantity) || Number.isNaN(quantity)) {
          throw new Error("Quantity must be a number.");
        }
        if (!Number.isFinite(price) || Number.isNaN(price)) {
          throw new Error("Price must be a number.");
        }

        return {
          name,
          sku,
          category: category || null,
          description: description || null,
          quantity: Math.trunc(quantity),
          price,
          available: boolChecked('inventory_available')
        };
      }

      async function fetchJsonOrText(url, options = {}) {
        const response = await fetch(url, options);
        const text = await response.text();
        let body = text;
        try {
          body = text ? JSON.parse(text) : null;
        } catch (err) {
          body = text;
        }
        return { response, body };
      }

      const searchBtn = document.getElementById('search-btn');
      if (searchBtn) {
        searchBtn.addEventListener('click', async () => {
          const name = (val('inventory_name') || "").trim();
          if (!name) {
            setFlash("Please enter a Name before searching.", true);
            return;
          }
          setFlash("Searching...");
          try {
            const res = await fetch(`${INVENTORY_BASE}?name=${encodeURIComponent(name)}`);
            if (!res.ok) {
              const body = await res.text();
              renderResults(body || `Error ${res.status}`);
              setFlash(body || `Error ${res.status}`, true);
              return;
            }
            const data = await res.json();
            renderResults(data);
            if (Array.isArray(data) && data.length > 0) {
              fillManageForm(data[0]);
            }
            setFlash("Success");
          } catch (err) {
            setFlash(`Error: ${err.message || err}`, true);
          }
        });
      }

      const listBtn = document.getElementById('list-btn');
      if (listBtn) {
        listBtn.addEventListener('click', async () => {
          setFlash("Listing...");
          try {
            const res = await fetch(INVENTORY_BASE);
            if (!res.ok) {
              const body = await res.text();
              renderResults(body || `Error ${res.status}`);
              setFlash(body || `Error ${res.status}`, true);
              return;
            }
            const data = await res.json();
            renderResults(data);
            setFlash("Success");
          } catch (err) {
            setFlash(`Error: ${err.message || err}`, true);
          }
        });
      }

      const queryBtn = document.getElementById('query-btn');
      if (queryBtn) {
        queryBtn.addEventListener('click', async () => {
          const category = (val('inventory_category') || "").trim();
          if (!category) {
            setFlash("Enter a category before querying.", true);
            return;
          }
          setFlash("Querying...");
          try {
            const res = await fetch(`${INVENTORY_BASE}?category=${encodeURIComponent(category)}`);
            if (!res.ok) {
              const body = await res.text();
              renderResults(body || `Error ${res.status}`);
              setFlash(body || `Error ${res.status}`, true);
              return;
            }
            const data = await res.json();
            renderResults(data);
            setFlash("Success");
          } catch (err) {
            setFlash(`Error: ${err.message || err}`, true);
          }
        });
      }

      const retrieveBtn = document.getElementById('retrieve-btn');
      if (retrieveBtn) {
        retrieveBtn.addEventListener('click', async () => {
          const id = requireInventoryId();
          if (!id) {
            return;
          }
          setFlash("Retrieving...");
          try {
            const res = await fetch(`${INVENTORY_BASE}/${encodeURIComponent(id)}`);
            if (!res.ok) {
              const body = await res.text();
              renderResults(body || `Error ${res.status}`);
              setFlash(body || `Error ${res.status}`, true);
              return;
            }
            const data = await res.json();
            fillManageForm(data);
            renderResults(data);
            setFlash("Success");
          } catch (err) {
            setFlash(`Error: ${err.message || err}`, true);
          }
        });
      }

      const updateBtn = document.getElementById('update-btn');
      if (updateBtn) {
        updateBtn.addEventListener('click', async () => {
          const id = requireInventoryId();
          if (!id) {
            return;
          }
          let payload;
          try {
            payload = buildUpdatePayload();
          } catch (err) {
            setFlash(err.message || "Invalid data", true);
            return;
          }
          setFlash("Updating...");
          try {
            const { response, body } = await fetchJsonOrText(`${INVENTORY_BASE}/${encodeURIComponent(id)}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });
            if (!response.ok) {
              renderResults(body || `Error ${response.status}`);
              setFlash((body && body.message) || `Error ${response.status}`, true);
              return;
            }
            if (body) {
              fillManageForm(body);
            }
            renderResults(body);
            setFlash("Success");
          } catch (err) {
            setFlash(`Error: ${err.message || err}`, true);
          }
        });
      }

      const deleteManageBtn = document.getElementById('delete-btn');
      if (deleteManageBtn) {
        deleteManageBtn.addEventListener('click', async () => {
          const id = requireInventoryId();
          if (!id) {
            return;
          }
          setFlash("Deleting...");
          try {
            const res = await fetch(`${INVENTORY_BASE}/${encodeURIComponent(id)}`, { method: 'DELETE' });
            if (res.status === 204) {
              renderResults(`Deleted inventory ${id}.`);
              setFlash("Success");
              return;
            }
            const body = await res.text();
            renderResults(body || `Error ${res.status}`);
            setFlash(body || `Error ${res.status}`, true);
          } catch (err) {
            setFlash(`Error: ${err.message || err}`, true);
          }
        });
      }

      const actionBtn = document.getElementById('action-btn');
      if (actionBtn) {
        actionBtn.addEventListener('click', async () => {
          const id = requireInventoryId();
          if (!id) {
            return;
          }
          setFlash("Running action...");
          try {
            const { response, body } = await fetchJsonOrText(`${INVENTORY_BASE}/${encodeURIComponent(id)}/purchase`, {
              method: 'PUT'
            });
            if (!response.ok) {
              renderResults(body || `Error ${response.status}`);
              setFlash((body && body.message) || `Error ${response.status}`, true);
              return;
            }
            if (body) {
              fillManageForm(body);
            }
            renderResults(body);
            setFlash("Success");
          } catch (err) {
            setFlash(`Error: ${err.message || err}`, true);
          }
        });
      }

      const clearBtn = document.getElementById('clear-btn');
      if (clearBtn) {
        clearBtn.addEventListener('click', () => {
          clearManageForm();
        });
      }

      // Send JSON to /api/inventory on button click and always write a result (success or error).
      const submitBtn = document.getElementById('submit');
      if (submitBtn) {
        submitBtn.addEventListener('click', async () => {
          const result = document.getElementById('result');
          if (!result) {
            console.warn('Missing result element');
            return;
          }

          // Build payload explicitly from element ids (avoid HTMLFormElement.name collision)
          const payload = {
            name: (val('name') || "").trim(),
            sku: (val('sku') || "").trim(),
            quantity: Number(val('quantity') || "0"),
            restock_level: val('restock_level') === "" ? null : Number(val('restock_level')),
            category: (val('category') || "").trim() || null,
            description: (val('description') || "").trim() || null,
            price: val('price') === "" ? null : Number(val('price')),
            available: boolChecked('available')
          };

          // Show payload for debugging before sending
          result.textContent = 'Submitting...\nPayload: ' + JSON.stringify(payload);

          try {
            const res = await fetch(INVENTORY_BASE, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });
            const text = await res.text();
            // Echo payload with the response to aid debugging in headless runs
            result.textContent = `Status ${res.status}\n` + text + `\nEcho-Payload: ` + JSON.stringify(payload);
          } catch (err) {
            result.textContent = `Status 0\n` + String(err) + `\nEcho-Payload: ` + JSON.stringify(payload);
          }
        });
      }

      // Delete handler targets /api/inventory/<id>
      const deleteBtn = document.getElementById('delete');
      if (deleteBtn) {
        deleteBtn.addEventListener('click', async () => {
          const result = document.getElementById('delete-result');
          if (!result) {
            console.warn('Missing delete result element');
            return;
          }
          const id = (val('delete-id') || "").trim();

          if (!id) {
            result.textContent = "Provide an inventory id to delete.";
            return;
          }

          result.textContent = `Deleting inventory ${id}...`;
          try {
            const res = await fetch(`${INVENTORY_BASE}/${encodeURIComponent(id)}`, { method: 'DELETE' });
            const body = await res.text();
            const ok = res.status === 204;
            result.textContent = `Status ${res.status}\n` + (ok ? `Inventory ${id} deleted.` : body || "Unexpected response.");
          } catch (err) {
            result.textContent = `Status 0\n` + String(err);
          }
        });
      }

      const statusBtn = document.getElementById('status');
      if (statusBtn) {
        statusBtn.addEventListener('click', async () => {
          const result = document.getElementById('status-result');
          if (!result) {
            console.warn('Missing status result element');
            return;
          }
          const id = (val('status-id') || "").trim();

          if (!id) {
            result.textContent = "Provide an inventory id.";
            return;
          }

          result.textContent = `Checking stock status for inventory ${id}...`;

          try {
            const res = await fetch(`${INVENTORY_BASE}/${encodeURIComponent(id)}/restock-status`, {
              method: 'GET',
            });

            const text = await res.text();
            result.textContent = `Status ${res.status}\n` + text;

          } catch (err) {
            result.textContent = `Status 0\n` + String(err);
          }
        });
      }

      const readBtn = document.getElementById('read');
      if (readBtn) {
        readBtn.addEventListener('click', async () => {
          const result = document.getElementById('read-result');
          if (!result) {
            console.warn('Missing read result element');
            return;
          }
          const id = (val('read-id') || "").trim();
          if (!id) {
            result.textContent = "Provide an inventory id.";
            return;
          }
          result.textContent = `Fetching inventory ${id}...`;
          try {
            const res = await fetch(`${INVENTORY_BASE}/${encodeURIComponent(id)}`);
            const text = await res.text();
            if (!res.ok) {
              result.textContent = `Status ${res.status}\n` + (text || "Not found.");
              return;
            }
            try {
              const data = text ? JSON.parse(text) : {};
              result.textContent = `Status ${res.status}\n` + JSON.stringify(data, null, 2);
            } catch (err) {
              result.textContent = `Status ${res.status}\n` + text;
            }
          } catch (err) {
            result.textContent = `Status 0\n` + String(err);
          }
        });
      }
    </script>
  </body>
</html>
