<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Create Inventory</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; max-width: 720px; margin: 2rem auto; }
      label { display: block; margin: 0.5rem 0; }
      input[type="text"], input[type="number"] { width: 320px; padding: 6px; }
      button { padding: 8px 14px; }
      #result { background: #f6f8fa; padding: 12px; white-space: pre-wrap; border-radius: 6px; border: 1px solid #e1e4e8; min-height: 2.2em; }
    </style>
  </head>
  <body>
    <h1>Create Inventory</h1>

    <form id="inv-form">
      <label>Name <input id="name" name="name" type="text" required></label>
      <label>SKU <input id="sku" name="sku" type="text" required></label>
      <label>Quantity <input id="quantity" name="quantity" type="number" min="0" value="0" required></label>
      <label>Category <input id="category" name="category" type="text"></label>
      <label>Description <input id="description" name="description" type="text"></label>
      <label>Price <input id="price" name="price" type="number" step="0.01" min="0"></label>
      <label>Available <input id="available" name="available" type="checkbox" checked></label>
      <!-- Use a button (not submit) to avoid native form navigation -->
      <button id="submit" type="button">Create</button>
    </form>

    <h3>Result</h3>
    <pre id="result" aria-live="polite"></pre>

    <script>
      // Safe getters by id
      function val(id) { const el = document.getElementById(id); return el ? el.value : ""; }
      function boolChecked(id) { const el = document.getElementById(id); return !!(el && el.checked); }

      // Send JSON to /inventories on button click and always write a result (success or error).
      document.getElementById('submit').addEventListener('click', async () => {
        const result = document.getElementById('result');

        // Build payload explicitly from element ids (avoid HTMLFormElement.name collision)
        const payload = {
          name: (val('name') || "").trim(),
          sku: (val('sku') || "").trim(),
          quantity: Number(val('quantity') || "0"),
          category: (val('category') || "").trim() || null,
          description: (val('description') || "").trim() || null,
          price: val('price') === "" ? null : Number(val('price')),
          available: boolChecked('available')
        };

        // Show payload for debugging before sending
        result.textContent = 'Submitting...\nPayload: ' + JSON.stringify(payload);

        try {
          const res = await fetch('/inventories', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          const text = await res.text();
          // Echo payload with the response to aid debugging in headless runs
          result.textContent = `Status ${res.status}\n` + text + `\nEcho-Payload: ` + JSON.stringify(payload);
        } catch (err) {
          result.textContent = `Status 0\n` + String(err) + `\nEcho-Payload: ` + JSON.stringify(payload);
        }
      });
    </script>
  </body>
</html>
